@model DynamicDataModel

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Table View</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/css/styles.css" asp-append-version="true" />

</head>
<body class="container mt-1">

    <!-- Search Section -->
    <div class="masterdiv mb-12">
        <div class="row">
            <div class="col-md-3">
                <input type="text" name="textSearchStore" id="textSearchStore" class="selectorinput form-control" placeholder="Store" onkeyup="StoreFilter()">
            </div>
        </div>
        <div class="row">
            <div class="col-md-3">
                <select class="form-control" id="Stores" multiple>
                    @foreach (var data in Model.TableData) 
                    {
                        @if (data.ContainsKey("Store")) 
                        {
                            <option class="optionfilter" value="@data["Store"]" title="@data["Store"]">
                                @data["Store"]
                            </option>
                        }
                    }
                </select>

            </div>
        </div>
    </div>

    <!-- Filter Section with Search Bar and Dropdown -->
    <div class="filter-section row g-3 mb-3">
        <div class="col-md-6">
            <label for="filterColumn" class="form-label">Filter By:</label>
            <select id="filterColumn" class="form-select">
                <option value="">-- Select Column --</option>
                @foreach (var field in Model.FieldNames)
                {
                    <option value="@field">@field</option>
                }
            </select>
        </div>
        <div class="col-md-6">
            <label for="textSearchMarket" class="form-label">Search:</label>
            <input type="text" id="textSearchMarket" class="form-control" placeholder="Search..." onkeyup="MarketFilter()">
        </div>
    </div>

    <!-- Data Table -->
    <div class="table-container">
        <table id="dataTable" class="table table-striped table-bordered">
            <thead class="table-dark">
                <tr>
                    @foreach (var field in Model.FieldNames)
                    {
                        <th>@field</th>
                    }
                </tr>
            </thead>
            <tbody>
                @foreach (var row in Model.TotalSum)
                {
                    <tr>
                        <td>Grand Total</td>
                        @foreach (var field in Model.FieldNames)
                        {
                            <td data-column="@field">@(row.ContainsKey(field) ? row[field] : "--")</td>
                        }
                    </tr>

                }
                @foreach (var row in Model.TableData)
                {
                    <tr>
                        @foreach (var field in Model.FieldNames)
                        {
                            <td data-column="@field">@(row.ContainsKey(field) ? row[field] : "N/A")</td>
                        }
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <script>
        // Filter store data
        // function StoreFilter() {
        //     let input = document.getElementById("textSearchStore").value.toLowerCase();
        //     document.querySelectorAll("#Stores option").forEach(option => {
        //         option.style.display = option.text.toLowerCase().includes(input) ? "" : "none";
        //     });
        // }

        // Store filter function to filter both the dropdown and table
        function StoreFilter() {
            let input = document.getElementById("textSearchStore").value.toLowerCase();

            // Filter store dropdown options
            document.querySelectorAll("#Stores option").forEach(option => {
                option.style.display = option.text.toLowerCase().includes(input) ? "" : "none";
            });

            // Filter table based on store column
            let table = document.getElementById("dataTable");
            let tr = table.getElementsByTagName("tr");

            for (let i = 1; i < tr.length; i++) {
                let td = tr[i].querySelector("[data-column='Store']"); // Find the "Store" column
                if (td) {
                    let textValue = td.textContent || td.innerText;
                    tr[i].style.display = textValue.toLowerCase().includes(input) ? "" : "none";
                }
            }
        }


        // Table row filter logic
        function MarketFilter() {
            var input = document.getElementById("textSearchMarket").value.toUpperCase();
            var table = document.getElementById("dataTable");
            var tr = table.getElementsByTagName("tr");
            var selectedColumn = document.getElementById("filterColumn").value;

            for (var i = 1; i < tr.length; i++) {
                var tds = tr[i].getElementsByTagName("td");
                var match = false;

                for (var j = 0; j < tds.length; j++) {
                    if (tds[j]) {
                        var textValue = tds[j].textContent || tds[j].innerText;
                        var columnName = tds[j].getAttribute("data-column");

                        if (textValue.toUpperCase().indexOf(input) > -1 && (selectedColumn === "" || columnName === selectedColumn)) {
                            match = true;
                            break;
                        }
                    }
                }
                tr[i].style.display = match ? "" : "none";  // Show or hide the row based on the match
            }
        }


    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
